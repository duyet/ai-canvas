<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F-Test Explorer: Phân tích Phương sai</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons (Phosphor Icons) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            50: '#fff1f2',
                            100: '#ffe4e6',
                            500: '#f43f5e', // Rose theme for F-test
                            600: '#e11d48',
                            700: '#be123c',
                            900: '#881337',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: #ffffff; border: 2px solid #e11d48; cursor: pointer;
            margin-top: -8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 6px; cursor: pointer; background: #e2e8f0; border-radius: 4px;
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
        }
        .canvas-container { position: relative; width: 100%; height: 350px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased min-h-screen flex flex-col">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-brand-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-brand-500/30">
                    <i class="ph-bold ph-graph text-2xl"></i>
                </div>
                <div>
                    <h1 class="font-bold text-xl tracking-tight text-slate-900">F-Test <span class="text-brand-600">Explorer</span></h1>
                    <p class="text-xs text-slate-500 font-medium">Phân tích Phương sai (ANOVA)</p>
                </div>
            </div>

            <!-- Nav -->
            <nav class="hidden md:flex gap-1 bg-slate-100 p-1 rounded-lg">
                <button onclick="switchTab('concept')" class="nav-btn active px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 text-slate-600 hover:text-slate-900" data-target="concept">
                    <i class="ph ph-lightbulb mr-1.5"></i> Bản chất
                </button>
                <button onclick="switchTab('lab')" class="nav-btn px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 text-slate-600 hover:text-slate-900" data-target="lab">
                    <i class="ph ph-sliders-horizontal mr-1.5"></i> Mô phỏng
                </button>
                <button onclick="switchTab('comparison')" class="nav-btn px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 text-slate-600 hover:text-slate-900" data-target="comparison">
                    <i class="ph ph-scales mr-1.5"></i> Tại sao không dùng T-test?
                </button>
            </nav>
            
             <button class="md:hidden p-2 text-slate-600" onclick="alert('Vui lòng sử dụng màn hình lớn hơn để có trải nghiệm tốt nhất!')">
                <i class="ph ph-list text-2xl"></i>
            </button>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-7xl">
        
        <!-- SECTION 1: CONCEPT -->
        <section id="concept" class="tab-content block animate-fade-in">
            <div class="max-w-4xl mx-auto text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-6 leading-tight">
                    F-Test: Tỷ lệ của <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-600 to-purple-500">Sự Biến Thiên</span>
                </h2>
                <p class="text-base text-slate-600 leading-relaxed max-w-3xl mx-auto">
                    Nếu T-test so sánh giá trị trung bình (Mean), thì F-test so sánh <strong>Phương sai (Variance)</strong>.
                    Trong phân tích phương sai (ANOVA), F-test trả lời câu hỏi: <em>"Sự khác biệt GIỮA các nhóm có lớn hơn sự lộn xộn TRONG NỘI BỘ mỗi nhóm hay không?"</em>
                </p>
            </div>

            <div class="grid md:grid-cols-2 gap-8 items-center py-8">
                <!-- Visual Formula -->
                <div class="flex flex-col items-center justify-center gap-6 select-none bg-white p-8 rounded-2xl border border-slate-200 shadow-sm">
                    <div class="text-6xl font-serif font-bold text-brand-600 italic">F</div>
                    <div class="text-4xl text-slate-300">=</div>
                    <div class="flex flex-col items-center gap-3 w-full">
                        <!-- Numerator -->
                        <div class="relative w-full">
                            <div class="bg-green-50 border border-green-200 p-4 rounded-lg text-center">
                                <div class="text-green-700 font-bold text-lg">Variance BETWEEN Groups</div>
                                <div class="text-xs text-green-600 font-medium uppercase mt-1">Tín hiệu (Signal)</div>
                                <div class="text-xs text-slate-500 mt-1">Các nhóm A, B, C cách nhau bao xa?</div>
                            </div>
                        </div>
                        
                        <!-- Divider -->
                        <div class="w-full h-0.5 bg-slate-800 rounded-full"></div>

                        <!-- Denominator -->
                        <div class="relative w-full">
                            <div class="bg-red-50 border border-red-200 p-4 rounded-lg text-center">
                                <div class="text-red-700 font-bold text-lg">Variance WITHIN Groups</div>
                                <div class="text-xs text-red-600 font-medium uppercase mt-1">Nhiễu (Noise)</div>
                                <div class="text-xs text-slate-500 mt-1">Dữ liệu trong từng nhóm lộn xộn thế nào?</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Explanation -->
                <div class="space-y-6">
                    <div class="flex gap-4">
                         <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 shrink-0 font-bold text-lg">1</div>
                         <div>
                             <h4 class="font-bold text-slate-900">Nếu F lớn (F >> 1)</h4>
                             <p class="text-sm text-slate-600">
                                 Tín hiệu át Nhiễu. Các nhóm thực sự khác biệt nhau.
                                 <br>Ví dụ: Thuật toán A chạy mất 10s, Thuật toán B mất 50s. Sự khác biệt rất rõ.
                             </p>
                         </div>
                    </div>
                    <div class="flex gap-4">
                        <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 shrink-0 font-bold text-lg">2</div>
                        <div>
                            <h4 class="font-bold text-slate-900">Nếu F nhỏ (F ≈ 1)</h4>
                            <p class="text-sm text-slate-600">
                                Tín hiệu bị chìm trong Nhiễu. 
                                <br>Ví dụ: Mean A = 10s, Mean B = 12s, nhưng mỗi lần chạy dao động +/- 5s. Không thể kết luận A nhanh hơn B.
                            </p>
                        </div>
                   </div>
                   <div class="bg-slate-100 p-4 rounded-lg text-sm text-slate-700 italic border-l-4 border-slate-400">
                       "Hãy tưởng tượng bạn đang nghe 3 đài radio. Nếu các đài phát nội dung rất khác nhau (Between lớn) và sóng mỗi đài đều trong trẻo (Within nhỏ), bạn dễ dàng phân biệt được chúng."
                   </div>
                </div>
            </div>

            <div class="mt-8 text-center">
                 <button onclick="switchTab('lab')" class="px-8 py-3 bg-brand-600 hover:bg-brand-500 text-white font-bold rounded-lg transition-all shadow-lg shadow-brand-500/30 flex items-center gap-2 mx-auto">
                    Vào phòng thí nghiệm ANOVA <i class="ph-bold ph-arrow-right"></i>
                </button>
            </div>
        </section>

        <!-- SECTION 2: LAB (CORE) -->
        <section id="lab" class="tab-content hidden animate-slide-up">
            <div class="grid lg:grid-cols-12 gap-6 h-full">
                
                <!-- Controls Sidebar -->
                <div class="lg:col-span-4 space-y-6">
                    <div class="glass-panel p-6 rounded-2xl sticky top-24">
                        <h3 class="font-bold text-slate-900 text-lg mb-6 flex items-center gap-2">
                            <i class="ph-duotone ph-sliders-horizontal text-brand-600"></i> Tham số 3 Nhóm
                        </h3>

                        <!-- Between Variance Control -->
                        <div class="mb-6">
                            <div class="flex justify-between items-end mb-2">
                                <label class="text-sm font-bold text-green-700">Độ lệch các nhóm (Between)</label>
                                <span class="text-xs font-mono bg-green-100 text-green-700 px-2 py-0.5 rounded" id="val-between">Trung bình</span>
                            </div>
                            <input type="range" id="input-between" min="0" max="40" value="10" class="w-full accent-green-600">
                            <p class="text-xs text-slate-400 mt-1">Khoảng cách giữa Mean A, B, và C.</p>
                        </div>

                        <!-- Within Variance Control -->
                        <div class="mb-6">
                            <div class="flex justify-between items-end mb-2">
                                <label class="text-sm font-bold text-red-700">Độ nhiễu nội bộ (Within)</label>
                                <span class="text-xs font-mono bg-red-100 text-red-700 px-2 py-0.5 rounded" id="val-within">5</span>
                            </div>
                            <input type="range" id="input-within" min="2" max="20" value="5" class="w-full accent-red-600">
                            <p class="text-xs text-slate-400 mt-1">Độ rộng (SD) của mỗi quả chuông.</p>
                        </div>

                         <div class="bg-slate-50 p-3 rounded-lg border border-slate-200 text-xs text-slate-600">
                            <strong class="block mb-1">Kịch bản Data Engineer:</strong>
                            Bạn đang so sánh thời gian xử lý (Processing Time) của 3 loại Cluster:
                            <ul class="list-disc pl-4 mt-1 space-y-1">
                                <li><span class="text-blue-600 font-bold">A:</span> Standard HDD</li>
                                <li><span class="text-purple-600 font-bold">B:</span> SSD Basic</li>
                                <li><span class="text-orange-600 font-bold">C:</span> NVMe High-End</li>
                            </ul>
                        </div>

                    </div>
                </div>

                <!-- Visualization Area -->
                <div class="lg:col-span-8 space-y-6">
                    
                    <!-- Result Header -->
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="glass-panel p-4 rounded-xl text-center ring-2 ring-brand-100">
                            <div class="text-xs text-brand-600 font-bold uppercase tracking-wider mb-1">F-Statistic</div>
                            <div class="text-3xl font-mono font-bold text-brand-600" id="res-f">--</div>
                        </div>
                        <div class="glass-panel p-4 rounded-xl text-center">
                            <div class="text-xs text-slate-500 font-medium uppercase tracking-wider mb-1">P-Value</div>
                            <div class="text-2xl font-mono font-bold text-slate-800" id="res-p">--</div>
                        </div>
                         <div class="glass-panel p-4 rounded-xl text-center col-span-2 md:col-span-1 bg-slate-50">
                            <div class="text-xs text-slate-500 font-medium uppercase tracking-wider mb-1">Kết luận</div>
                            <div class="text-sm font-bold text-slate-800" id="res-text">--</div>
                        </div>
                    </div>

                    <!-- Canvas 1: Data Distribution -->
                    <div class="glass-panel p-1 rounded-2xl shadow-sm bg-white overflow-hidden relative">
                         <div class="absolute top-2 left-4 text-xs font-bold text-slate-400 uppercase">Phân phối dữ liệu (Data Distribution)</div>
                        <div class="canvas-container bg-gradient-to-b from-slate-50 to-white h-48">
                            <canvas id="dataCanvas"></canvas>
                        </div>
                    </div>

                    <!-- Canvas 2: F Distribution -->
                    <div class="glass-panel p-1 rounded-2xl shadow-sm bg-white overflow-hidden relative">
                         <div class="absolute top-2 left-4 text-xs font-bold text-slate-400 uppercase">Phân phối F (F-Distribution & Alpha)</div>
                        <div class="canvas-container bg-slate-50 h-40">
                            <canvas id="fDistCanvas"></canvas>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- SECTION 3: COMPARISON -->
        <section id="comparison" class="tab-content hidden animate-fade-in">
            <div class="max-w-5xl mx-auto space-y-8">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-slate-900">Tại sao không dùng nhiều T-test?</h2>
                    <p class="text-slate-500 mt-2">Ví dụ có 3 nhóm A, B, C. Tại sao không so sánh (A vs B), (B vs C), (A vs C)?</p>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <div class="w-10 h-10 bg-red-100 text-red-600 rounded-lg flex items-center justify-center mb-4 text-xl">
                            <i class="ph-bold ph-warning-octagon"></i>
                        </div>
                        <h3 class="font-bold text-slate-900 mb-2">Vấn đề: Lạm phát sai lầm (Type I Error)</h3>
                        <p class="text-sm text-slate-600 leading-relaxed mb-4">
                            Mỗi lần bạn chạy một T-test với Alpha = 0.05, bạn có 5% nguy cơ kết luận sai (dương tính giả).
                            <br><br>
                            Nếu chạy 3 lần T-test độc lập:
                            <br>Nguy cơ sai lầm tích lũy ≈ <span class="font-mono font-bold text-red-600">1 - (0.95)^3 ≈ 14.3%</span>
                        </p>
                        <div class="text-xs bg-red-50 text-red-700 p-2 rounded">
                            Bạn càng so sánh nhiều cặp, khả năng tìm thấy sự khác biệt "ảo" càng cao.
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <div class="w-10 h-10 bg-green-100 text-green-600 rounded-lg flex items-center justify-center mb-4 text-xl">
                            <i class="ph-bold ph-check-circle"></i>
                        </div>
                        <h3 class="font-bold text-slate-900 mb-2">Giải pháp: ANOVA (F-test)</h3>
                        <p class="text-sm text-slate-600 leading-relaxed mb-4">
                            ANOVA thực hiện <strong>một lần kiểm tra duy nhất</strong> cho tất cả các nhóm.
                            <br><br>
                            Nó trả lời câu hỏi tổng quát: "Có bất kỳ sự khác biệt nào giữa các nhóm này không?". Nếu câu trả lời là CÓ (F lớn), lúc đó chúng ta mới đi sâu vào tìm xem cụ thể nhóm nào khác nhóm nào (Post-hoc test).
                        </p>
                        <div class="text-xs bg-green-50 text-green-700 p-2 rounded">
                            Giữ mức rủi ro sai lầm ổn định ở mức 5%.
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-slate-200 py-8 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <p class="text-slate-400 font-mono text-xs">
                (c) duyetbot | Built for Data Engineers
            </p>
        </div>
    </footer>

    <!-- LOGIC SCRIPT -->
    <script>
        // --- CONSTANTS ---
        const jStat = {
            normal: function(x, mean, std) {
                return (1 / (Math.sqrt(2 * Math.PI) * std)) * Math.exp(-0.5 * Math.pow((x - mean) / std, 2));
            },
            // Simplified F distribution PDF for Visualization (Approx)
            // Real F-pdf is complex (Gamma functions), we use a rough shape approx for demo
            fPDF: function(x, df1, df2) {
                if(x < 0) return 0;
                // Shape approximation for visualization only
                // This is NOT the exact math formula to avoid heavy Gamma implementation in vanilla JS
                // It mimics the right-skewed shape.
                return Math.pow(x, (df1/2)-1) * Math.pow(1 + (df1/df2)*x, -(df1+df2)/2);
            }
        };

        // --- STATE ---
        const state = {
            betweenVar: 10,
            withinVar: 5,
            groupMeans: [40, 50, 60] // Initial centers
        };

        // --- DOM ---
        const els = {
            inBetween: document.getElementById('input-between'),
            inWithin: document.getElementById('input-within'),
            lblBetween: document.getElementById('val-between'),
            lblWithin: document.getElementById('val-within'),
            
            resF: document.getElementById('res-f'),
            resP: document.getElementById('res-p'),
            resText: document.getElementById('res-text'),
            
            canvasData: document.getElementById('dataCanvas'),
            canvasF: document.getElementById('fDistCanvas')
        };
        const ctxData = els.canvasData.getContext('2d');
        const ctxF = els.canvasF.getContext('2d');

        // --- INIT ---
        function init() {
            resizeCanvases();
            window.addEventListener('resize', () => { resizeCanvases(); update(); });

            els.inBetween.addEventListener('input', (e) => {
                const val = parseInt(e.target.value);
                state.betweenVar = val;
                // Update means based on "Between Variance"
                // Center is 50. We spread them out.
                // Spread factor simply multiplies the distance from center
                const spread = val * 1.5; 
                state.groupMeans = [50 - spread, 50, 50 + spread]; 
                
                // Label text
                if(val < 5) els.lblBetween.innerText = "Rất gần nhau";
                else if(val < 15) els.lblBetween.innerText = "Trung bình";
                else els.lblBetween.innerText = "Rất xa nhau";

                update();
            });

            els.inWithin.addEventListener('input', (e) => {
                state.withinVar = parseInt(e.target.value);
                els.lblWithin.innerText = state.withinVar;
                update();
            });

            switchTab('concept');
            // Init calculation
            state.groupMeans = [50 - (10*1.5), 50, 50 + (10*1.5)];
            update();
        }

        function resizeCanvases() {
            [els.canvasData, els.canvasF].forEach(canvas => {
                const container = canvas.parentElement;
                canvas.width = container.clientWidth * 2;
                canvas.height = container.clientHeight * 2;
                canvas.style.width = container.clientWidth + 'px';
                canvas.style.height = container.clientHeight + 'px';
                const ctx = canvas.getContext('2d');
                ctx.scale(2, 2);
            });
        }

        // --- LOGIC ---
        function update() {
            // 1. Calculate Statistics (Simulated)
            // F = Variance Between / Variance Within
            
            // Variance Between = Sum((Mean_i - GrandMean)^2) / (k-1)
            // Grand Mean is 50 (since our groups are symmetric around 50)
            const grandMean = 50;
            const k = 3; // 3 groups
            const n = 30; // Sample size per group
            
            // Calculate Sum of Squares Between (SSB)
            let ssb = 0;
            state.groupMeans.forEach(m => {
                ssb += n * Math.pow(m - grandMean, 2);
            });
            const msb = ssb / (k - 1); // Mean Square Between

            // Calculate Sum of Squares Within (SSW)
            // We assume standard deviation = state.withinVar
            // Variance = SD^2
            const variance = Math.pow(state.withinVar, 2);
            // SSW = sum of variance of each group * (n-1)
            const ssw = k * (n - 1) * variance;
            const msw = ssw / (k * (n - 1)); // Mean Square Within

            // F Ratio
            const fValue = msb / msw;

            // P-value approximation
            // For visualization purposes, we use a simple decay function logic 
            // because calculating exact P from F involves Beta functions.
            // Heuristic: F > 3.0 usually significant for these df
            let pValue = 1 / (1 + Math.exp(fValue - 3)); 
            if(fValue > 10) pValue = 0.000;
            else if(fValue < 0.1) pValue = 0.999;
            else {
                // Better heuristic for F-dist shape
                pValue = Math.exp(-0.5 * fValue); 
                if(pValue > 1) pValue = 1;
            }

            // Update UI
            els.resF.innerText = fValue.toFixed(2);
            els.resP.innerText = pValue < 0.001 ? "< 0.001" : pValue.toFixed(3);

            const alpha = 0.05;
            const isSig = pValue < alpha;
            
            if (isSig) {
                els.resText.innerHTML = `<span class="text-brand-600">Khác biệt có ý nghĩa!</span>`;
            } else {
                els.resText.innerHTML = `<span class="text-slate-500">Chưa có sự khác biệt.</span>`;
            }

            // 2. Draw Data
            drawData();
            
            // 3. Draw F Distribution
            drawF(fValue, isSig);
        }

        function drawData() {
            const width = els.canvasData.width / 2;
            const height = els.canvasData.height / 2;
            ctxData.clearRect(0, 0, width, height);

            // Scale X axis (0 to 100)
            const mapX = (x) => (x / 100) * width;
            const yBase = height - 20;
            
            // Auto scale Y based on SD (smaller SD = taller peak)
            const maxPeak = jStat.normal(50, 50, 2); // reference peak
            const currentPeak = jStat.normal(50, 50, state.withinVar);
            const yScale = (height * 0.7) / currentPeak;

            const drawBell = (mean, color) => {
                ctxData.beginPath();
                ctxData.moveTo(mapX(0), yBase);
                for(let x=0; x<=100; x+=0.5) {
                    const y = jStat.normal(x, mean, state.withinVar);
                    ctxData.lineTo(mapX(x), yBase - y * yScale);
                }
                ctxData.strokeStyle = color;
                ctxData.lineWidth = 2;
                ctxData.stroke();
                ctxData.fillStyle = color + "20"; // hex + alpha
                ctxData.fill();
            };

            drawBell(state.groupMeans[0], "#2563eb"); // Blue
            drawBell(state.groupMeans[1], "#9333ea"); // Purple
            drawBell(state.groupMeans[2], "#ea580c"); // Orange
            
            // X Axis
            ctxData.beginPath();
            ctxData.moveTo(0, yBase);
            ctxData.lineTo(width, yBase);
            ctxData.strokeStyle = "#cbd5e1";
            ctxData.stroke();
        }

        function drawF(fVal, isSig) {
            const width = els.canvasF.width / 2;
            const height = els.canvasF.height / 2;
            ctxF.clearRect(0, 0, width, height);

            const xMax = 10; // View range for F
            const mapX = (f) => (f / xMax) * width;
            const yBase = height - 20;
            const yScale = height * 0.8; // Approximate

            // Draw Curve (Simulated Shape)
            ctxF.beginPath();
            ctxF.moveTo(0, yBase);
            
            // We draw a generic F-like curve for visual reference
            // Roughly peak at 1.0, long tail
            for(let x=0; x<=xMax; x+=0.1) {
                // Using a Gamma-like shape function for visual simple representation
                // y = x^a * e^-bx
                const y = Math.pow(x, 2) * Math.exp(-1.5 * x); 
                // Normalize roughly
                const yNorm = y * 2.5; 
                ctxF.lineTo(mapX(x), yBase - yNorm * yScale);
            }
            ctxF.strokeStyle = "#64748b";
            ctxF.lineWidth = 2;
            ctxF.stroke();

            // Critical Region (Alpha = 0.05)
            // Visually around F = 3.0 for many df
            const fCrit = 3.0; 
            ctxF.fillStyle = "rgba(225, 29, 72, 0.1)"; // brand-600 very light
            ctxF.fillRect(mapX(fCrit), 0, width - mapX(fCrit), height);
            
            // Draw Critical Line
            ctxF.beginPath();
            ctxF.moveTo(mapX(fCrit), 0);
            ctxF.lineTo(mapX(fCrit), yBase);
            ctxF.strokeStyle = "#e11d48";
            ctxF.setLineDash([5, 5]);
            ctxF.stroke();
            ctxF.setLineDash([]);
            ctxF.fillStyle = "#e11d48";
            ctxF.font = "10px Inter";
            ctxF.fillText("Critical (α)", mapX(fCrit)+5, 20);

            // Draw Observed F
            const obsX = mapX(Math.min(fVal, xMax)); // Clamp to view
            ctxF.beginPath();
            ctxF.moveTo(obsX, 0);
            ctxF.lineTo(obsX, yBase);
            ctxF.strokeStyle = isSig ? "#16a34a" : "#1e293b"; // Green if sig, Dark if not
            ctxF.lineWidth = 3;
            ctxF.stroke();

            // Label F
            ctxF.fillStyle = isSig ? "#16a34a" : "#1e293b";
            ctxF.font = "bold 12px Inter";
            ctxF.textAlign = "center";
            ctxF.fillText(`F = ${fVal.toFixed(1)}`, obsX, yBase - 10);
        }

        window.switchTab = function(tabId) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if (btn.dataset.target === tabId) {
                    btn.classList.add('bg-slate-200', 'text-slate-900', 'shadow-sm');
                    btn.classList.remove('text-slate-600');
                } else {
                    btn.classList.remove('bg-slate-200', 'text-slate-900', 'shadow-sm');
                    btn.classList.add('text-slate-600');
                }
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('hidden', content.id !== tabId);
            });
            if (tabId === 'lab') {
                setTimeout(() => { resizeCanvases(); update(); }, 50);
            }
        }

        init();
    </script>
</body>
</html>
